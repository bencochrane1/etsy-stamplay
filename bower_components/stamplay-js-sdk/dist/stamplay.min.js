/*! Stamplay v1.3.3 | (c) 2015 The Stamplay Dreamteam */

(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=t(d,f,4);var g=!A(c)&&s.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function b(a){return function(b,c,d){c=u(c,d);for(var e=z(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function c(a,b,c){return function(d,e,f){var g=0,h=z(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(k.call(d,g,h),s.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}}function d(a,b){var c=F.length,d=a.constructor,e=s.isFunction(d)&&d.prototype||h,f="constructor";for(s.has(a,f)&&!s.contains(b,f)&&b.push(f);c--;)f=F[c],f in a&&a[f]!==e[f]&&!s.contains(b,f)&&b.push(f)}var e=this,f=e._,g=Array.prototype,h=Object.prototype,i=Function.prototype,j=g.push,k=g.slice,l=h.toString,m=h.hasOwnProperty,n=Array.isArray,o=Object.keys,p=i.bind,q=Object.create,r=function(){},s=function(a){return a instanceof s?a:this instanceof s?void(this._wrapped=a):new s(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports._=s):e._=s,s.VERSION="1.8.3";var t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){return null==a?s.identity:s.isFunction(a)?t(a,b,c):s.isObject(a)?s.matcher(a):s.property(a)};s.iteratee=function(a,b){return u(a,b,1/0)};var v=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},w=function(a){if(!s.isObject(a))return{};if(q)return q(a);r.prototype=a;var b=new r;return r.prototype=null,b},x=function(a){return function(b){return null==b?void 0:b[a]}},y=Math.pow(2,53)-1,z=x("length"),A=function(a){var b=z(a);return"number"==typeof b&&b>=0&&y>=b};s.each=s.forEach=function(a,b,c){b=t(b,c);var d,e;if(A(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=s.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},s.map=s.collect=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},s.reduce=s.foldl=s.inject=a(1),s.reduceRight=s.foldr=a(-1),s.find=s.detect=function(a,b,c){var d;return d=A(a)?s.findIndex(a,b,c):s.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},s.filter=s.select=function(a,b,c){var d=[];return b=u(b,c),s.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},s.reject=function(a,b,c){return s.filter(a,s.negate(u(b)),c)},s.every=s.all=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},s.some=s.any=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},s.contains=s.includes=s.include=function(a,b,c,d){return A(a)||(a=s.values(a)),("number"!=typeof c||d)&&(c=0),s.indexOf(a,b,c)>=0},s.invoke=function(a,b){var c=k.call(arguments,2),d=s.isFunction(b);return s.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},s.pluck=function(a,b){return s.map(a,s.property(b))},s.where=function(a,b){return s.filter(a,s.matcher(b))},s.findWhere=function(a,b){return s.find(a,s.matcher(b))},s.max=function(a,b,c){var d,e,f=-1/0,g=-1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-1/0&&f===-1/0)&&(f=a,g=e)});return f},s.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(g>e||1/0===e&&1/0===f)&&(f=a,g=e)});return f},s.shuffle=function(a){for(var b,c=A(a)?a:s.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=s.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},s.sample=function(a,b,c){return null==b||c?(A(a)||(a=s.values(a)),a[s.random(a.length-1)]):s.shuffle(a).slice(0,Math.max(0,b))},s.sortBy=function(a,b,c){return b=u(b,c),s.pluck(s.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(a){return function(b,c,d){var e={};return c=u(c,d),s.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};s.groupBy=B(function(a,b,c){s.has(a,c)?a[c].push(b):a[c]=[b]}),s.indexBy=B(function(a,b,c){a[c]=b}),s.countBy=B(function(a,b,c){s.has(a,c)?a[c]++:a[c]=1}),s.toArray=function(a){return a?s.isArray(a)?k.call(a):A(a)?s.map(a,s.identity):s.values(a):[]},s.size=function(a){return null==a?0:A(a)?a.length:s.keys(a).length},s.partition=function(a,b,c){b=u(b,c);var d=[],e=[];return s.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},s.first=s.head=s.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:s.initial(a,a.length-b)},s.initial=function(a,b,c){return k.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},s.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:s.rest(a,Math.max(0,a.length-b))},s.rest=s.tail=s.drop=function(a,b,c){return k.call(a,null==b||c?1:b)},s.compact=function(a){return s.filter(a,s.identity)};var C=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=z(a);h>g;g++){var i=a[g];if(A(i)&&(s.isArray(i)||s.isArguments(i))){b||(i=C(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};s.flatten=function(a,b){return C(a,b,!1)},s.without=function(a){return s.difference(a,k.call(arguments,1))},s.uniq=s.unique=function(a,b,c,d){s.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=u(c,d));for(var e=[],f=[],g=0,h=z(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?s.contains(f,j)||(f.push(j),e.push(i)):s.contains(e,i)||e.push(i)}return e},s.union=function(){return s.uniq(C(arguments,!0,!0))},s.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=z(a);e>d;d++){var f=a[d];if(!s.contains(b,f)){for(var g=1;c>g&&s.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},s.difference=function(a){var b=C(arguments,!0,!0,1);return s.filter(a,function(a){return!s.contains(b,a)})},s.zip=function(){return s.unzip(arguments)},s.unzip=function(a){for(var b=a&&s.max(a,z).length||0,c=Array(b),d=0;b>d;d++)c[d]=s.pluck(a,d);return c},s.object=function(a,b){for(var c={},d=0,e=z(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},s.findIndex=b(1),s.findLastIndex=b(-1),s.sortedIndex=function(a,b,c,d){c=u(c,d,1);for(var e=c(b),f=0,g=z(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},s.indexOf=c(1,s.findIndex,s.sortedIndex),s.lastIndexOf=c(-1,s.findLastIndex),s.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var D=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=w(a.prototype),g=a.apply(f,e);return s.isObject(g)?g:f};s.bind=function(a,b){if(p&&a.bind===p)return p.apply(a,k.call(arguments,1));if(!s.isFunction(a))throw new TypeError("Bind must be called on a function");var c=k.call(arguments,2),d=function(){return D(a,d,b,this,c.concat(k.call(arguments)))};return d},s.partial=function(a){var b=k.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===s?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return D(a,c,this,this,f)};return c},s.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=s.bind(a[c],a);return a},s.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return s.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},s.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},s.defer=s.partial(s.delay,s,1),s.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:s.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=s.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},s.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=s.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=s.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},s.wrap=function(a,b){return s.partial(b,a)},s.negate=function(a){return function(){return!a.apply(this,arguments)}},s.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},s.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},s.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},s.once=s.partial(s.before,2);var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];s.keys=function(a){if(!s.isObject(a))return[];if(o)return o(a);var b=[];for(var c in a)s.has(a,c)&&b.push(c);return E&&d(a,b),b},s.allKeys=function(a){if(!s.isObject(a))return[];var b=[];for(var c in a)b.push(c);return E&&d(a,b),b},s.values=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},s.mapObject=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},s.pairs=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},s.invert=function(a){for(var b={},c=s.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},s.functions=s.methods=function(a){var b=[];for(var c in a)s.isFunction(a[c])&&b.push(c);return b.sort()},s.extend=v(s.allKeys),s.extendOwn=s.assign=v(s.keys),s.findKey=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},s.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;s.isFunction(b)?(e=s.allKeys(g),d=t(b,c)):(e=C(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},s.omit=function(a,b,c){if(s.isFunction(b))b=s.negate(b);else{var d=s.map(C(arguments,!1,!1,1),String);b=function(a,b){return!s.contains(d,b)}}return s.pick(a,b,c)},s.defaults=v(s.allKeys,!0),s.create=function(a,b){var c=w(a);return b&&s.extendOwn(c,b),c},s.clone=function(a){return s.isObject(a)?s.isArray(a)?a.slice():s.extend({},a):a},s.tap=function(a,b){return b(a),a},s.isMatch=function(a,b){var c=s.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof s&&(a=a._wrapped),b instanceof s&&(b=b._wrapped);var e=l.call(a);if(e!==l.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(s.isFunction(g)&&g instanceof g&&s.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!G(a[i],b[i],c,d))return!1}else{var j,k=s.keys(a);if(i=k.length,s.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!s.has(b,j)||!G(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};s.isEqual=function(a,b){return G(a,b)},s.isEmpty=function(a){return null==a?!0:A(a)&&(s.isArray(a)||s.isString(a)||s.isArguments(a))?0===a.length:0===s.keys(a).length},s.isElement=function(a){return!(!a||1!==a.nodeType)},s.isArray=n||function(a){return"[object Array]"===l.call(a)},s.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},s.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){s["is"+a]=function(b){return l.call(b)==="[object "+a+"]"}}),s.isArguments(arguments)||(s.isArguments=function(a){return s.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(s.isFunction=function(a){return"function"==typeof a||!1}),s.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},s.isNaN=function(a){return s.isNumber(a)&&a!==+a},s.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===l.call(a)},s.isNull=function(a){return null===a},s.isUndefined=function(a){return void 0===a},s.has=function(a,b){return null!=a&&m.call(a,b)},s.noConflict=function(){return e._=f,this},s.identity=function(a){return a},s.constant=function(a){return function(){return a}},s.noop=function(){},s.property=x,s.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},s.matcher=s.matches=function(a){return a=s.extendOwn({},a),function(b){return s.isMatch(b,a)}},s.times=function(a,b,c){var d=Array(Math.max(0,a));b=t(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},s.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},s.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=s.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+s.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};s.escape=J(H),s.unescape=J(I),s.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),s.isFunction(d)?d.call(a):d};var K=0;s.uniqueId=function(a){var b=++K+"";return a?a+b:b},s.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,O=function(a){return"\\"+M[a]};s.template=function(a,b,c){!b&&c&&(b=c),b=s.defaults({},b,s.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(N,O),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,s)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},s.chain=function(a){var b=s(a);return b._chain=!0,b};var P=function(a,b){return a._chain?s(b).chain():b};s.mixin=function(a){s.each(s.functions(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=[this._wrapped];return j.apply(a,arguments),P(this,c.apply(s,a))}})},s.mixin(s),s.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];s.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],P(this,c)}}),s.each(["concat","join","slice"],function(a){var b=g[a];s.prototype[a]=function(){return P(this,b.apply(this._wrapped,arguments))}}),s.prototype.value=function(){return this._wrapped},s.prototype.valueOf=s.prototype.toJSON=s.prototype.value,s.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return s})}).call(this),function(a){"use strict";if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports&&"object"==typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var b="undefined"!=typeof window?window:self,c=b.Q;b.Q=a(),b.Q.noConflict=function(){return b.Q=c,this}}}(function(){"use strict";function a(a){return function(){return W.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===cb(a)||a instanceof S}function d(a,b){if(P&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(db)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+db+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===R&&d>=T&&ib>=d}function i(){if(P)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=g(c);if(!d)return;return R=d[0],d[1]}}function j(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function k(a){return a instanceof o?a:s(a)?B(a):A(a)}function l(){function a(a){b=a,f.source=a,Y(c,function(b,c){k.nextTick(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=_(l.prototype),f=_(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=X(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):k.nextTick(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&P)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(A(c))},e.reject=function(c){b||a(z(c))},e.notify=function(a){b||Y(d,function(b,c){k.nextTick(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return z(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=_(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=z(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return a instanceof o}function s(a){return b(a)&&"function"==typeof a.then}function t(a){return r(a)&&"pending"===a.inspect().state}function u(a){return!r(a)||"fulfilled"===a.inspect().state}function v(a){return r(a)&&"rejected"===a.inspect().state}function w(){eb.length=0,fb.length=0,hb||(hb=!0)}function x(a,b){hb&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){-1!==Z(fb,a)&&(process.emit("unhandledRejection",b,a),gb.push(a))}),fb.push(a),eb.push(b&&"undefined"!=typeof b.stack?b.stack:"(no stack) "+b))}function y(a){if(hb){var b=Z(fb,a);-1!==b&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){var c=Z(gb,a);-1!==c&&(process.emit("rejectionHandled",eb[b],a),gb.splice(c,1))}),fb.splice(b,1),eb.splice(b,1))}}function z(a){var b=o({when:function(b){return b&&y(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return x(b,a),b}function A(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return bb(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function B(a){var b=l();return k.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function C(a){return o({isDef:function(){}},function(b,c){return I(a,b,c)},function(){return k(a).inspect()})}function D(a,b,c){return k(a).spread(b,c)}function E(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=d[a](b)}catch(h){return z(h)}return g.done?k(g.value):p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?k(h.value):z(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function F(a){k.done(k.async(a)())}function G(a){throw new S(a)}function H(a){return function(){return D([this,J(arguments)],function(b,c){return a.apply(b,c)})}}function I(a,b,c){return k(a).dispatch(b,c)}function J(a){return p(a,function(a){var b=0,c=l();return Y(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function K(a){if(0===a.length)return k.resolve();var b=k.defer(),c=0;return Y(a,function(d,e,f){function g(a){b.resolve(a)}function h(){c--,0===c&&b.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function i(a){b.notify({index:f,value:a})}var j=a[f];c++,p(j,g,h,i)},void 0),b.promise}function L(a){return p(a,function(a){return a=$(a,k),p(J($(a,function(a){return p(a,U,U)})),function(){return a})})}function M(a){return k(a).allSettled()}function N(a,b){return k(a).then(void 0,void 0,b)}function O(a,b){return k(a).nodeify(b)}var P=!1;try{throw new Error}catch(Q){P=!!Q.stack}var R,S,T=i(),U=function(){},V=function(){function a(){for(var a,d;c.next;)c=c.next,a=c.task,c.task=void 0,d=c.domain,d&&(c.domain=void 0,d.enter()),b(a,d);for(;h.length;)a=h.pop(),b(a);e=!1}function b(b,c){try{b()}catch(d){if(g)throw c&&c.exit(),setTimeout(a,0),c&&c.enter(),d;setTimeout(function(){throw d},0)}c&&c.exit()}var c={task:void 0,next:null},d=c,e=!1,f=void 0,g=!1,h=[];if(V=function(a){d=d.next={task:a,domain:g&&process.domain,next:null},e||(e=!0,f())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)g=!0,f=function(){process.nextTick(a)};else if("function"==typeof setImmediate)f="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var i=new MessageChannel;i.port1.onmessage=function(){f=j,i.port1.onmessage=a,a()};var j=function(){i.port2.postMessage(0)};f=function(){setTimeout(a,0),j()}}else f=function(){setTimeout(a,0)};return V.runAfter=function(a){h.push(a),e||(e=!0,f())},V}(),W=Function.call,X=a(Array.prototype.slice),Y=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Z=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),$=a(Array.prototype.map||function(a,b){var c=this,d=[];return Y(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),_=Object.create||function(a){function b(){}return b.prototype=a,new b},ab=a(Object.prototype.hasOwnProperty),bb=Object.keys||function(a){var b=[];for(var c in a)ab(a,c)&&b.push(c);return b},cb=a(Object.prototype.toString);S="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var db="From previous event:";k.resolve=k,k.nextTick=V,k.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(k.longStackSupport=!0),k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?X(arguments,1):c)}},k.Promise=m,k.promise=m,m.race=n,m.all=J,m.reject=z,m.resolve=k,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return z(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return z(c)}}return z(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return k.nextTick(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.tap=function(a,b){return k(a).tap(b)},o.prototype.tap=function(a){return a=k(a),this.then(function(b){return a.fcall(b).thenResolve(b)})},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=t,o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=u,o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=v,o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var eb=[],fb=[],gb=[],hb=!0;k.resetUnhandledRejections=w,k.getUnhandledReasons=function(){return eb.slice()},k.stopUnhandledRejectionTracking=function(){w(),hb=!1},w(),k.reject=z,k.fulfill=A,k.master=C,k.spread=D,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=E,k.spawn=F,k["return"]=G,k.promised=H,k.dispatch=I,o.prototype.dispatch=function(a,b){var c=this,d=l();return k.nextTick(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k["delete"]=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype["delete"]=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,X(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,X(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k["try"]=k.fcall=function(a){return k(a).dispatch("apply",[void 0,X(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},k.fbind=function(a){var b=k(a),c=X(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(X(arguments))])}},o.prototype.fbind=function(){var a=this,b=X(arguments);return function(){return a.dispatch("apply",[this,b.concat(X(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=J,o.prototype.all=function(){return J(this)},k.any=K,o.prototype.any=function(){return K(this)},k.allResolved=j(L,"allResolved","allSettled"),o.prototype.allResolved=function(){return L(this)},k.allSettled=M,o.prototype.allSettled=function(){return this.then(function(a){return J($(a,function(a){function b(){return a.inspect()}return a=k(a),a.then(b,b)}))})},k.fail=k["catch"]=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype["catch"]=function(a){return this.then(void 0,a)},k.progress=N,o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k["finally"]=function(a,b){return k(a)["finally"](b)},o.prototype.fin=o.prototype["finally"]=function(a){return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){k.nextTick(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=X(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=X(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=X(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=X(arguments,1);return function(){var c=b.concat(X(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=X(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=X(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(X(arguments)),f=l();return e.push(f.makeNodeResolver()),k(d).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=X(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=X(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=X(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=X(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=O,o.prototype.nodeify=function(a){return a?void this.then(function(b){k.nextTick(function(){a(null,b)})},function(b){k.nextTick(function(){a(b)})}):this},k.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var ib=i();return k}),function(a){function b(){try{return g in a&&a[g]
}catch(b){return!1}}function c(a){return a.replace(/^d/,"___$&").replace(m,"___")}var d,e={},f=a.document,g="localStorage",h="script";if(e.disabled=!1,e.version="1.3.17",e.set=function(){},e.get=function(){},e.has=function(a){return void 0!==e.get(a)},e.remove=function(){},e.clear=function(){},e.transact=function(a,b,c){null==c&&(c=b,b=null),null==b&&(b={});var d=e.get(a,b);c(d),e.set(a,d)},e.getAll=function(){},e.forEach=function(){},e.serialize=function(a){return JSON.stringify(a)},e.deserialize=function(a){if("string"!=typeof a)return void 0;try{return JSON.parse(a)}catch(b){return a||void 0}},b())d=a[g],e.set=function(a,b){return void 0===b?e.remove(a):(d.setItem(a,e.serialize(b)),b)},e.get=function(a,b){var c=e.deserialize(d.getItem(a));return void 0===c?b:c},e.remove=function(a){d.removeItem(a)},e.clear=function(){d.clear()},e.getAll=function(){var a={};return e.forEach(function(b,c){a[b]=c}),a},e.forEach=function(a){for(var b=0;b<d.length;b++){var c=d.key(b);a(c,e.get(c))}};else if(f.documentElement.addBehavior){var i,j;try{j=new ActiveXObject("htmlfile"),j.open(),j.write("<"+h+">document.w=window</"+h+'><iframe src="/favicon.ico"></iframe>'),j.close(),i=j.w.frames[0].document,d=i.createElement("div")}catch(k){d=f.createElement("div"),i=f.body}var l=function(a){return function(){var b=Array.prototype.slice.call(arguments,0);b.unshift(d),i.appendChild(d),d.addBehavior("#default#userData"),d.load(g);var c=a.apply(e,b);return i.removeChild(d),c}},m=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");e.set=l(function(a,b,d){return b=c(b),void 0===d?e.remove(b):(a.setAttribute(b,e.serialize(d)),a.save(g),d)}),e.get=l(function(a,b,d){b=c(b);var f=e.deserialize(a.getAttribute(b));return void 0===f?d:f}),e.remove=l(function(a,b){b=c(b),a.removeAttribute(b),a.save(g)}),e.clear=l(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(g);for(var c,d=0;c=b[d];d++)a.removeAttribute(c.name);a.save(g)}),e.getAll=function(){var a={};return e.forEach(function(b,c){a[b]=c}),a},e.forEach=l(function(a,b){for(var c,d=a.XMLDocument.documentElement.attributes,f=0;c=d[f];++f)b(c.name,e.deserialize(a.getAttribute(c.name)))})}try{var n="__storejs__";e.set(n,n),e.get(n)!=n&&(e.disabled=!0),e.remove(n)}catch(k){e.disabled=!0}e.enabled=!e.disabled,"undefined"!=typeof module&&module.exports&&this.module!==module?module.exports=e:"function"==typeof define&&define.amd?define(e):a.store=e}(Function("return this")()),function(a){function b(a){return decodeURIComponent((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}a.Stamplay=a.Stamplay||{},a.Stamplay.VERSION="v1",Q.stopUnhandledRejectionTracking(),a.Stamplay.APPID="",a.Stamplay.BASEURL="",window.localStorage&&store.enabled&&(a.Stamplay.USESTORAGE=!0),b("jwt")&&Stamplay.USESTORAGE&&store.set(window.location.origin+"-jwt",b("jwt")),a.Stamplay.init=function(b){a.Stamplay.BASEURL="https://"+b+".stamplayapp.com",a.Stamplay.APPID=b}}(this),function(a){function b(a){var b=a.getResponseHeader("x-stamplay-jwt");if(b){var d=c(b);Stamplay.USESTORAGE&&store.set(window.location.origin+"-jwt",b)}return d}function c(a){var b={},c={},e="";try{var f=a.split(".");b=JSON.parse(d(f[0]||"{}")),c=JSON.parse(d(f[1]||"{}")),e=f[2]}catch(g){}return{header:b,claims:c,signature:e}}function d(a){return"undefined"!=typeof atob?atob(a):e(a)}function e(a){var b,c,d,e,f={},g=0,h=0,i="",j=String.fromCharCode,k=a.length,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(b=0;64>b;b++)f[l.charAt(b)]=b;for(d=0;k>d;d++)for(c=f[a.charAt(d)],g=(g<<6)+c,h+=6;h>=8;)((e=g>>>(h-=8)&255)||k-2>d)&&(i+=j(e));return i}function f(a){var b,d,e=c(a).claims,f=Math.floor((new Date).getTime()/1e3);if("object"==typeof e){if(e.hasOwnProperty("iat")){b=e.iat;var g=3e4,h=new Date(1e3*b),i=new Date(h-g);b=i.getTime()/1e3}d=e.hasOwnProperty("exp")?e.exp:b+86400}return f&&b&&d&&f>=b&&d>=f}var g=function(a){for(var b=Object.keys(a.thisParams),c=0;c<b.length;c++){var d=c>0?"&":"?",e=b[c];a.url=a.url+d+e+"="+a.thisParams[e]}},h=function(a,b){for(var c=0;c<a.length;c++){var d=a[c].split(";");if(2!=d.length)throw new Error("section could not be split on ';'");var e=d[0].replace(/<(.*)>/,"$1").trim(),f=d[1].replace(/rel="(.*)"/,"$1").trim();e.indexOf("&sort=")<0&&(e+="&sort=-dt_create"),b[f]=e}};a.Stamplay.makeAPromise=function(c,d){c.thisParams&&g(c);var e;""!=a.Stamplay.APPID?(c.url=a.Stamplay.BASEURL+c.url,e=a.Stamplay.APPID):(e=location.host,e=e.replace(/^www\./,""),e=e.replace(/:[0-9]*$/g,""));var i=Q.defer(),j=new XMLHttpRequest;if(j.open(c.method||"GET",c.url,c.async||!0),Object.keys(c.headers||{}).forEach(function(a){j.setRequestHeader(a,c.headers[a])}),j.setRequestHeader("Content-Type","application/json"),j.setRequestHeader("stamplay-app",e),Stamplay.USESTORAGE){var k=store.get(window.location.origin+"-jwt");k&&(f(k)?j.setRequestHeader("x-stamplay-jwt",k):store.remove(window.location.origin+"-jwt"))}return j.onreadystatechange=function(){if(4===j.readyState)if(-1===[200,304].indexOf(j.status))i.reject(j);else{var a=JSON.parse(j.responseText);if(b(j),d&&j.getResponseHeader("link")){var c=j.getResponseHeader("link").split(",");a.pagination={},h(c,a.pagination),a.totalElements=j.getResponseHeader("x-total-elements"),i.resolve(a)}else i.resolve(a)}},j.send(JSON.stringify(c.data)||void 0),i.promise},a.Stamplay.removeAttributes=function(a,b){switch(a){case"cobject":delete b.__v,delete b.cobjectId,delete b.actions,delete b.appId,delete b.id;break;case"user":delete b._id,delete b.id,delete b.__v}}}(this),function(a){function b(){var a=function(a,b){var c=this;return b?Stamplay.makeAPromise({method:"PUT",data:{type:b},url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/"+this.resourceId+"/"+this.instance._id+"/"+a}).then(function(a){c.instance=a}):Stamplay.makeAPromise({method:"PUT",url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/"+this.resourceId+"/"+this.instance._id+"/"+a}).then(function(a){c.instance=a})};this.upVote=function(){return a.call(this,"vote","upvote")},this.downVote=function(){return a.call(this,"vote","downvote")},this.rate=function(a){var b=this;if(parseInt(a))return Stamplay.makeAPromise({method:"PUT",data:{rate:a},url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/"+this.resourceId+"/"+this.instance._id+"/rate"}).then(function(a){b.instance=a});throw new Error("vote parameter to rate function must be a integer")},this.comment=function(a){var b=this;return Stamplay.makeAPromise({method:"PUT",data:{text:a},url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/"+this.resourceId+"/"+this.instance._id+"/comment"}).then(function(a){b.instance=a})},this.twitterShare=function(){return a.call(this,"twitter_share")},this.facebookShare=function(){return a.call(this,"facebook_share")},this.getComments=function(){return this.get("actions").comments},this.getVotes=function(a){return!a||"up"!==a&&"down"!==a?this.get("actions").votes.users:this.get("actions").votes["users_"+a+"vote"]},this.getRatings=function(){return this.get("actions").ratings.users},this.getTwitterShares=function(){return this.get("actions").twitter_shares.users},this.getFacebookShares=function(){return this.get("actions").facebook_shares.users}}function c(a,c,d){this.instance={},this.brickId=a,this.resourceId=c;var e={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};g(this,e,"instance"),d&&b.call(this),this.constructor=function(a){this.instance={};for(var b=Object.keys(a),c=0,d=b.length;d>c;c++){var e=b[c],f=a[e];this.set(e,f)}return this},this.get=function(a){return this.instance[a]},this.set=function(a,b){this.instance[a]=b},this.unset=function(a){delete this.instance[a]},this.fetch=function(a,b){b=b||{};var c=this;return Stamplay.makeAPromise({method:"GET",url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/"+this.resourceId+"/"+a,thisParams:b}).then(function(a){c.instance=a})},this.save=function(a){a=a||{};var b=function(){return a.patch?"PATCH":"PUT"};if(this.instance){var c=this.instance._id?b():"POST",d="/api/"+this.brickId+"/"+Stamplay.VERSION+"/"+this.resourceId;("PATCH"===c||"PUT"===c)&&(d=d+"/"+this.get("_id"),Stamplay.removeAttributes(this.brickId,this.instance));var e=this;return Stamplay.makeAPromise({method:c,url:d,data:this.instance}).then(function(a){e.instance=a})}},this.destroy=function(){var a="user"===this.brickId;return this.get("_id")?Stamplay.makeAPromise({method:"DELETE",url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/"+this.resourceId+"/"+this.get("_id")}).then(function(b){if(a&&Stamplay.USESTORAGE){var c=store.get(window.location.origin+"-jwt");c&&store.remove(window.location.origin+"-jwt")}return b}):!1}}function d(b,c){this.instance=[],this.brickId=b,this.resourceId=c,this.length=this.instance.length,this.totalElement=0,this.link={},this.currentQuery={};var d=function(a){var b={};for(var c in a)if("find"===c)for(var d in a[c])b[d]=a[c][d];else"limit"===c?b.n=a[c]:"select"===c?b.select=a[c].join(","):"sort"===c?b.sort=a[c]:"pagination"===c?(b.page=a[c][0],b.per_page=a[c][1]):"populate"===c?b.populate=!0:"populateOwner"===c&&(b.populate_owner=!0);return b};this.compile=function(){return d(this.currentQuery)},this.populate=function(){return this.currentQuery.populate=!0,this},this.populateOwner=function(){return this.currentQuery.populateOwner=!0,this},this.pagination=function(a,b){if(!a||!b)throw new Error("Pagination want two parameters");return this.currentQuery.pagination=[a,b],this},this.equalTo=function(a,b){if(this.currentQuery.find||(this.currentQuery.find={}),"object"==typeof a)for(var c in a)this.currentQuery.find[c]=a[c];else this.currentQuery.find[a]=b;return this},this.limit=function(a){return this.currentQuery.limit=a,this},this.select=function(a){if(this.currentQuery.select||(this.currentQuery.select=[]),a instanceof Array)for(var b=0;b<a.length;b++)this.currentQuery.select.push(a[b]);else this.currentQuery.select.push(a);return this},this.sortAscending=function(a){return this.currentQuery.sort=a,this},this.sortDescending=function(a){return this.currentQuery.sort="-"+a,this};var e={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,reject:3,every:3,all:3,some:3,any:3,include:2,contains:2,invoke:2,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3};g(this,e,"instance"),this.get=function(a){for(var b=0,c=this.instance.length;c>b;b++)if(this.instance[b].get("_id")==a)return this.instance[b]},this.at=function(a){return this.instance[a]},this.pop=function(){var a=this.instance[this.instance.length-1];return 0!=this.instance.length?(this.remove(a.get("_id")),a):!1},this.shift=function(){var a=this.instance[0];return a?(this.remove(a.get("_id")),a):!1},this.add=function(a){a instanceof Object&&a.brickId==this.brickId&&a.get("_id")&&("cobject"==a.brickId?a.resourceId==this.resourceId&&(this.instance.push(a),this.length=this.instance.length):(this.instance.push(a),this.length=this.instance.length))},this.count=function(){return this.totalElements},this.set=function(b){if(!(b instanceof Array))throw new Error("Set method on Collection wants an Array");var c=this;b.forEach(function(b){if(b instanceof Object){var d;if("cobject"==c.brickId)d=new a.Stamplay.Cobject(c.resourceId),d=d.Model.constructor(b);else{var e=c.brickId.charAt(0).toUpperCase()+c.brickId.slice(1);d=new a.Stamplay[e],d=d.Model.constructor(b)}c.instance.push(d)}}),c.length=c.instance.length},this.fetch=function(b){b=b&&_.extend(b,this.compile())||this.compile();var c=this;if("cobject"===c.brickId)var d=!0;return Stamplay.makeAPromise({method:"GET",url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/"+this.resourceId,thisParams:b},d).then(function(b){b.totalElements&&b.pagination&&(c.totalElements=parseInt(b.totalElements),c.pagination=b.pagination),c.instance=[],b.data.forEach(function(b){var d;if("cobject"===c.brickId)d=new a.Stamplay.Cobject(c.resourceId),d=d.Model.constructor(b);else{var e=c.brickId.charAt(0).toUpperCase()+c.brickId.slice(1);d=new a.Stamplay[e],d=d.Model.constructor(b)}c.instance.push(d)}),c.length=c.instance.length})},this.remove=function(a){a instanceof Array?(this.instance=_.reject(this.instance,function(b){for(var c in a)if(b.get("_id")==a[c])return!0},this),this.length=this.instance.length):(this.instance=_.reject(this.instance,function(b){return b.get("_id")==a?!0:void 0},this),this.length=this.instance.length)}}function e(a,b,e){this.Model={},this.Collection={},c.call(this.Model,a,b,e),d.call(this.Collection,a,b)}var f=function(a,b,c){switch(a){case 1:return function(){return _[b](this[c])};case 2:return function(a){return _[b](this[c],a)};case 3:return function(a,d){return _[b](this[c],a,d)};case 4:return function(a,d,e){return _[b](this[c],a,d,e)};default:return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(this[c]),_[b].apply(_,a)}}},g=function(a,b,c){_.each(b,function(b,d){_[d]&&(a[d]=f.call(a,b,d,c))})};a.Stamplay.BaseComponent=e}(this),function(a){function b(){this.redirect=function(a){window.location.href=a},this.validateEmail=function(a){return Stamplay.makeAPromise({method:"POST",data:{email:a},url:"/api/auth/"+Stamplay.VERSION+"/validate/email"})},this.checkMongoId=function(a){var b=new RegExp("^[0-9a-fA-F]{24}$"),c="string"==typeof a&&b.test(a);return c},this.errorSender=function(a,b){var c=Q.defer();return c.reject({status:a,message:b}),c.promise}}var c=new b;a.Stamplay.Support=c}(this),function(a){function b(b,c){this.model=b,this.instance=c,this.currentQuery=[],this.executable="",this.or=function(){var b={$or:[]};arguments[0]instanceof Array&&(arguments=arguments[0]);for(var c=0;c<arguments.length;c++){if(!(arguments[c]instanceof a.Stamplay.Query))throw new Error("Please Or function take only Query object");b.$or.push(arguments[c].currentQuery[0])}return this.currentQuery.push(b),this},this.between=function(a,b,c){var d={};return d[a]={$gte:b,$lte:c},this.currentQuery.push(d),this},this.greaterThan=function(a,b){var c={};return c[a]={$gt:b},this.currentQuery.push(c),this},this.greaterThanOrEqual=function(a,b){var c={};return c[a]={$gte:b},this.currentQuery.push(c),this},this.lessThan=function(a,b){var c={};return c[a]={$lt:b},this.currentQuery.push(c),this},this.lessThanOrEqual=function(a,b){var c={};return c[a]={$lte:b},this.currentQuery.push(c),this},this.equalTo=function(a,b){var c={};return c[a]=b,this.currentQuery.push(c),this},this.sortAscending=function(a){var b={$sort:{}};return b.$sort[a]=1,this.currentQuery.push(b),this},this.sortDescending=function(a){var b={$sort:{}};return b.$sort[a]=-1,this.currentQuery.push(b),this},this.exists=function(a){var b={};return b[a]={$exists:!0},this.currentQuery.push(b),this},this.notExists=function(a){var b={};return b[a]={$exists:!1},this.currentQuery.push(b),this},this.exec=function(){for(var a=0;a<this.currentQuery.length;a++){var b=JSON.stringify(this.currentQuery[a]);b=b.substring(1,b.length-1),this.executable+=0===a?b:","+b}return this.instance||(this.instance=this.model+"s"),Stamplay.makeAPromise({method:"GET",url:"/api/"+this.model+"/"+Stamplay.VERSION+"/"+this.instance+"?where={"+this.executable+"}"}).then(function(a){return a.data})}}a.Stamplay.Query=b}(this),function(a){function b(){Stamplay.BaseComponent.call(this,"user","users"),this.Model.currentUser=function(){var a=this;return Stamplay.makeAPromise({method:"GET",url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/getStatus"}).then(function(b){a.instance=b.user||{}})},this.Model.isLogged=function(){return this.instance._id?!0:!1},this.Model.login=function(b,c){var d=this;if(c){var e={email:b,password:c};return Stamplay.makeAPromise({method:"POST",data:e,url:"/auth/"+Stamplay.VERSION+"/local/login"}).then(function(a){d.instance=a||{}})}var f=store.get(window.location.origin+"-jwt");if(f){var g=new Date;g.setTime(g.getTime()+3e5),document.cookie="stamplay.jwt="+f+"; expires="+g.toGMTString()+"; path=/"}var h="/auth/"+Stamplay.VERSION+"/"+b+"/connect",i=window.location.port?":"+window.location.port:"";a.Stamplay.Support.redirect(location.protocol+"//"+document.domain+i+h)},this.Model.signup=function(a){if(a.email&&a.password){var b=this;return Stamplay.makeAPromise({method:"POST",data:a,url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/"+this.resourceId}).then(function(a){b.instance=a||{}})}throw new Error("Stamplay.User.Model.signup(data) needs that data object has the email and password keys")},this.Model.logout=function(){Stamplay.USESTORAGE&&store.remove(window.location.origin+"-jwt"),a.Stamplay.Support.redirect("/auth/"+Stamplay.VERSION+"/logout")},this.Model.resetPassword=function(a,b){return a&&b?Stamplay.makeAPromise({method:"POST",data:{email:a,newPassword:b},url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/users/resetpassword"}).then(function(a){return a}):Stamplay.Support.errorSender(403,"Missing parameters in resetPassword method")},this.Model.activities=function(a){return Stamplay.makeAPromise({method:"GET",url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/users/"+a+"/activities"}).then(function(a){return a})},this.Model.following=function(a){return Stamplay.makeAPromise({method:"GET",url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/users/"+a+"/following"}).then(function(a){return a})},this.Model.followedBy=function(a){return Stamplay.makeAPromise({method:"GET",url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/users/"+a+"/followed_by"}).then(function(a){return a})},this.Model.follow=function(a){return Stamplay.makeAPromise({method:"PUT",data:{userId:a},url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/users/follow"}).then(function(a){return a})},this.Model.unfollow=function(a){return Stamplay.makeAPromise({method:"PUT",data:{userId:a},url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/users/unfollow"}).then(function(a){return a})}}a.Stamplay.User=b}(this),function(a){function b(b){Stamplay.BaseComponent.call(this,"cobject",b,!0),this.Collection.findByAttr=function(b){if(b){var c=this;return Stamplay.makeAPromise({method:"GET",url:"/api/"+this.brickId+"/"+Stamplay.VERSION+"/"+this.resourceId+"/find/"+b}).then(function(b){b.totalElements&&b.pagination&&(c.totalElements=parseInt(b.totalElements),c.pagination=b.pagination),c.instance=[],b.data.forEach(function(b){var d=new a.Stamplay.Cobject(c.resourceId);d=d.Model.constructor(b),c.instance.push(d)}),c.length=c.instance.length})}return Stamplay.Support.errorSender(403,"Missing parameter in findByAttr method")}}a.Stamplay.Cobject=b}(this),function(a){function b(a){var b=a.replace(/[^\w\s]/gi,"").trim().toLowerCase().replace(/\s+/g,"_");this.url="/api/webhook/"+Stamplay.VERSION+"/"+b+"/catch",this.post=function(a,b){return Stamplay.makeAPromise({method:"POST",data:a,url:this.url,thisParams:b})},this.put=function(a,b){return Stamplay.makeAPromise({method:"PUT",data:a,url:this.url,thisParams:b})},this.get=function(a){return Stamplay.makeAPromise({method:"GET",url:this.url,thisParams:a})}}a.Stamplay.Webhook=b}(this),function(a){function b(){this.url="/api/stripe/"+Stamplay.VERSION+"/",this.createCustomer=function(a){return Stamplay.Support.checkMongoId(a)?Stamplay.makeAPromise({method:"POST",data:{userId:a},url:this.url+"customers"}):Stamplay.Support.errorSender(403,"Invalid userId")},this.createCreditCard=function(a,b){return 2==arguments.length?Stamplay.Support.checkMongoId(a)?Stamplay.makeAPromise({method:"POST",data:{token:b},url:this.url+"customers/"+a+"/cards"}):Stamplay.Support.errorSender(403,"Invalid userId"):Stamplay.Support.errorSender(403,"Missing parameters in createCreditCard methods")},this.updateCreditCard=function(a,b){return 2==arguments.length?Stamplay.Support.checkMongoId(a)?Stamplay.makeAPromise({method:"PUT",data:{token:b},url:this.url+"customers/"+a+"/cards"}):Stamplay.Support.errorSender(403,"Invalid userId"):Stamplay.Support.errorSender(403,"Missing parameters in updateCreditCard methods")},this.charge=function(a,b,c,d){return 4==arguments.length?Stamplay.Support.checkMongoId(a)?Stamplay.makeAPromise({method:"POST",data:{userId:a,token:b,amount:c,currency:d},url:this.url+"charges"}):Stamplay.Support.errorSender(403,"Invalid userId"):Stamplay.Support.errorSender(403,"Missing parameters in charge methods")},this.createSubscription=function(a,b){return 2===arguments.length?Stamplay.Support.checkMongoId(a)?Stamplay.makeAPromise({method:"POST",data:{planId:b},url:this.url+"customers/"+a+"/subscriptions"}):Stamplay.Support.errorSender(403,"Invalid userId"):Stamplay.Support.errorSender(403,"Missing parameters in createSubscription methods")},this.getSubscriptions=function(a,b){return arguments.length>=1?Stamplay.Support.checkMongoId(a)?Stamplay.makeAPromise({method:"GET",url:this.url+"customers/"+a+"/subscriptions",thisParams:b}):Stamplay.Support.errorSender(403,"Invalid userId"):Stamplay.Support.errorSender(403,"Missing parameters in getSubscriptions methods")},this.getSubscription=function(a,b){return arguments.length<=2?Stamplay.Support.checkMongoId(a)?Stamplay.makeAPromise({method:"GET",url:this.url+"customers/"+a+"/subscriptions/"+b}):Stamplay.Support.errorSender(403,"Invalid userId"):Stamplay.Support.errorSender(403,"Missing parameters in getSubscription methods")},this.getCreditCard=function(a){return 1==arguments.length?Stamplay.Support.checkMongoId(a)?Stamplay.makeAPromise({method:"GET",url:this.url+"customers/"+a+"/cards"}):Stamplay.Support.errorSender(403,"Invalid userId"):Stamplay.Support.errorSender(403,"Invalid parameter in getCreditCard method")},this.deleteSubscription=function(a,b,c){return 2===arguments.length?Stamplay.Support.checkMongoId(a)?Stamplay.makeAPromise({method:"DELETE",url:this.url+"customers/"+a+"/subscriptions/"+b,data:c||{}}):Stamplay.Support.errorSender(403,"Invalid userId"):Stamplay.Support.errorSender(403,"Missing parameters in deleteSubscription methods")},this.updateSubscription=function(a,b,c){return arguments.length>=2?Stamplay.Support.checkMongoId(a)?(c=c||{},Stamplay.makeAPromise({method:"PUT",url:this.url+"customers/"+a+"/subscriptions/"+b,data:{options:c}})):Stamplay.Support.errorSender(403,"Invalid userId"):Stamplay.Support.errorSender(403,"Missing parameters in updateSubscription methods")}}a.Stamplay.Stripe=b}(this),function(a){function b(a){function b(a){var b="POST";if("string"==typeof a)switch(a){case"GET":case"POST":case"PUT":case"PATCH":case"DELETE":b=a;break;default:return Stamplay.Support.errorSender(403,"Invalid HTTP verb: available verbs are GET,POST,PUT,PATCH and DELETE")}return b}function c(a,b){var c=null==b||void 0==b?void 0:b;switch(a){case"POST":case"PUT":case"PATCH":break;default:c=void 0}return c}var d=a.replace(/[^\w\s]/gi,"").trim().toLowerCase().replace(/\s+/g,"_");this.url="/api/codeblock/"+Stamplay.VERSION+"/run/"+d,this.run=function(a,d){var e=b("POST"),f=c("POST",a);return Stamplay.makeAPromise({method:e,data:f,url:this.url,thisParams:d})}}a.Stamplay.Codeblock=b}(this),function(a){function b(){this.url="/api/user/"+Stamplay.VERSION+"/roles",this.getRoles=function(){return Stamplay.makeAPromise({method:"GET",url:this.url})},this.getRole=function(a){return Stamplay.Support.checkMongoId(a)?Stamplay.makeAPromise({method:"GET",url:this.url+"/"+a}):Stamplay.Support.errorSender(403,"Invalid roleId")}}a.Stamplay.Role=b}(this);
//# sourceMappingURL=stamplay.min.map